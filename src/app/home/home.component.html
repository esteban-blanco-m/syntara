<main class="main-content" [class.active-view]="hasSearched">

  <div class="intro-section" *ngIf="!hasSearched">
    <div class="main-logo-section">
      <img src="assets/images/logo.png" alt="Syntara Main Logo" class="main-logo">
    </div>
    <h2 class="search-prompt">¿Qué producto quieres buscar hoy<span *ngIf="greetingName"> {{ greetingName }}</span>?
    </h2>
  </div>

  <div class="results-section" *ngIf="hasSearched">

    <h2 class="results-title">
      Resultados de búsqueda <br>
      <span
        [appTypewriter]="resultsTitleText"
        [typingSpeed]="40"
        style="min-height: 30px; display: block; font-weight: 400; font-size: 22px; margin-top: 8px;">
      </span>
    </h2>

    <div *ngIf="isLoading" class="loading-indicator">
      <p>Buscando los mejores precios...</p>
    </div>

    <div *ngIf="generalError && !isLoading" class="error-message">
      <p>{{ generalError }}</p>
    </div>

    <div class="results-table-container" *ngIf="!isLoading && results.length > 0">
      <table class="results-table">
        <thead>
        <tr>
          <th>TIENDA</th>
          <th>PRECIO</th>
          <th>PRECIO POR UND</th>
          <th>URL</th>
          <th>FECHA</th>
        </tr>
        </thead>

        <tbody [@listAnimation]="results.length">
        <tr *ngFor="let item of results; let first = first" [class.highlight-row]="first">
          <td class="store-name">{{ item.store }}</td>
          <td
            class="price-col"
            [class.offer-price]="item.isOffer">
            $ {{ item.price | number:'1.0-0' }}
          </td>
          <td class="unit-price-col">
            <span class="unit-price-value">$ {{ item.unitPrice | number:'1.0-0' }}</span>
            <span class="unit-price-label">/ {{ item.measureLabel }}</span>
          </td>
          <td>
            <a [href]="item.url" target="_blank" class="store-link">Ir a la tienda</a>
          </td>
          <td>{{ item.date | date:'short' }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="no-results-container" *ngIf="!isLoading && results.length === 0 && !generalError">
      <div class="icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="no-results-icon">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          <path d="M11 8v4"></path>
          <circle cx="11" cy="16" r="0.5" fill="currentColor"></circle>
        </svg>
      </div>
      <h3>¡Ups! No encontramos ese producto</h3>
      <p>
        Parece que <strong>{{ lastSearchQuery }}</strong> no está disponible por ahora.
      </p>
      <div class="suggestions">
        <span>Te sugerimos:</span>
        <ul>
          <li>Revisar la ortografía de la palabra.</li>
          <li>Usar términos más específicos (ej: "Arroz Diana" en vez de "Arroz").</li>
          <li>Verificar la categoría o unidad seleccionada.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="search-section" [class.search-active]="hasSearched">
    <div class="search-input-wrapper product-input">
      <input
        type="text"
        placeholder="Buscar producto (Producto - Marca)..."
        class="search-input"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()">
      <div class="search-error-tooltip" *ngIf="productError">
        {{ productError }}
      </div>
    </div>
    <div class="search-input-wrapper quantity-input">
      <input
        type="number"
        placeholder="Cant."
        class="search-input hide-spin-buttons"
        min="1" max="9999"
        [(ngModel)]="quantity"
        (keyup.enter)="onSearch()">
    </div>
    <div class="search-input-wrapper measure-select">
      <select class="search-input" [(ngModel)]="measure">
        <option value="" disabled selected>Unidad de medida</option>
        <optgroup label="Conteo">
          <option value="unidades">Unidades</option>
          <option value="pares">Pares</option>
          <option value="docenas">Docenas</option>
          <option value="cajas">Cajas</option>
          <option value="paquetes">Paquetes</option>
          <option value="bolsas">Bolsas</option>
          <option value="kits">Kits / Sets</option>
        </optgroup>
        <optgroup label="Peso (Masa)">
          <option value="kilogramos">Kilogramos (kg)</option>
          <option value="gramos">Gramos (g)</option>
          <option value="libras">Libras (lb)</option>
        </optgroup>
        <optgroup label="Peso Tradicional">
          <option value="arrobas">Arroba</option>
          <option value="quintales">Quintales</option>
          <option value="bultos">Bultos</option>
        </optgroup>
        <optgroup label="Volumen">
          <option value="litros">Litros (L)</option>
          <option value="mililitros">Mililitros (ml)</option>
          <option value="galones">Galones</option>
        </optgroup>
        <optgroup label="Longitud/Área">
          <option value="metros">Metros (m)</option>
          <option value="centimetros">Centímetros (cm)</option>
          <option value="metros_cuadrados">Metros Cuadrados (m²)</option>
        </optgroup>
      </select>
      <div class="search-error-tooltip" *ngIf="measureError">
        {{ measureError }}
      </div>
    </div>
    <button class="search-button" (click)="onSearch()">
      <span *ngIf="!hasSearched">Buscar</span>
      <img *ngIf="hasSearched" src="assets/images/logopequ.png" alt="Buscar" class="search-button-icon">
    </button>
  </div>

  <footer class="footer" *ngIf="!hasSearched">
    <p>Syntara • Los precios hablan, Syntara escucha. ©</p>
  </footer>
</main>
