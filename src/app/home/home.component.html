<main class="main-content" [class.active-view]="hasSearched">

  <div class="intro-section" *ngIf="!hasSearched">
    <div class="main-logo-section">
      <img src="assets/images/logo.png" alt="Syntara Main Logo" class="main-logo">
    </div>
    <h2 class="search-prompt">¿Qué producto quieres buscar hoy {{ greetingName }}?</h2>
  </div>

  <div class="results-section" *ngIf="hasSearched">

    <h2 class="results-title">
      Resultados de búsqueda <br>
      <!-- REVERTIDO: Muestra solo los campos originales -->
      <span>Producto buscado: {{ lastSearchQuery }} - {{ lastSearchQuantity }} {{ lastSearchMeasure }}</span>
    </h2>

    <div *ngIf="isLoading" class="loading-indicator">
      <p>Buscando los mejores precios...</p>
    </div>

    <!-- AÑADIDO: Bloque para errores generales de API -->
    <div *ngIf="generalError && !isLoading" class="error-message">
      <p>{{ generalError }}</p>
    </div>

    <div class="results-table-container" *ngIf="!isLoading && results.length > 0">
      <table class="results-table">
        <thead>
        <tr>
          <!-- REVERTIDO: Columnas originales -->
          <th>TIENDA</th>
          <th>PRECIO</th>
          <th>PRECIO POR UND</th>
          <th>URL</th>
        </tr>
        </thead>
        <tbody>
        <!-- REVERTIDO: Celdas originales. La API devuelve 'store', 'price', 'unitPrice' y 'url' -->
        <tr *ngFor="let item of results; let first = first" [class.highlight-row]="first">
          <td class="store-name">{{ item.store }}</td>
          <td class="price-col">$ {{ item.price | number:'1.0-0' }}</td>
          <td class="unit-price-col">
            <!-- NOTA: Tu API debe devolver 'unitPrice'. Si no, esto mostrará '$ 0' -->
            <span class="unit-price-value">$ {{ item.unitPrice | number:'1.0-0' }}</span>
            <span class="unit-price-label">/ {{ item.measureLabel }}</span>
          </td>
          <td>
            <a [href]="item.url" target="_blank" class="store-link">Ir a la tienda</a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Mensaje si no hay resultados -->
    <div *ngIf="!isLoading && results.length === 0 && !generalError">
      <p>No se encontraron resultados para esta búsqueda.</p>
    </div>
  </div>

  <!-- SECCIÓN DE BÚSQUEDA (Inputs) -->
  <div class="search-section" [class.search-active]="hasSearched">

    <!-- Input de Producto (Sin cambios) -->
    <div class="search-input-wrapper product-input">
      <input
        type="text"
        placeholder="Buscar producto (Producto - Marca)..."
        class="search-input"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()">

      <div class="search-error-tooltip" *ngIf="productError">
        {{ productError }}
      </div>
    </div>

    <!-- REVERTIDO: Se quitó el Select de Categoría -->

    <!-- Input de Cantidad (Sin cambios) -->
    <div class="search-input-wrapper quantity-input">
      <input
        type="number"
        placeholder="Cant."
        class="search-input hide-spin-buttons"
        min="1" max="9999"
        [(ngModel)]="quantity"
        (keyup.enter)="onSearch()">
    </div>

    <!-- Select de Medida (Sin cambios) -->
    <div class="search-input-wrapper measure-select">
      <select class="search-input" [(ngModel)]="measure">
        <option value="" disabled selected>Unidad de medida</option>
        <optgroup label="Conteo">
          <option value="unidades">Unidades</option>
          <option value="pares">Pares</option>
          <option value="docenas">Docenas</option>
          <option value="cajas">Cajas</option>
          <option value="paquetes">Paquetes</option>
          <option value="bolsas">Bolsas</option>
          <option value="kits">Kits / Sets</option>
        </optgroup>
        <optgroup label="Peso (Masa)">
          <option value="kilogramos">Kilogramos (kg)</option>
          <option value="gramos">Gramos (g)</option>
          <option value="libras">Libras (lb)</option>
        </optgroup>
        <optgroup label="Peso Tradicional">
          <option value="arrobas">Arroba</option>
          <option value="quintales">Quintales</option>
          <option value="bultos">Bultos</option>
        </optgroup>
        <optgroup label="Volumen">
          <option value="litros">Litros (L)</option>
          <option value="mililitros">Mililitros (ml)</option>
          <option value="galones">Galones</option>
        </optgroup>
        <optgroup label="Longitud/Área">
          <option value="metros">Metros (m)</option>
          <option value="centimetros">Centímetros (cm)</option>
          <option value="metros_cuadrados">Metros Cuadrados (m²)</option>
        </optgroup>
      </select>
      <div class="search-error-tooltip" *ngIf="measureError">
        {{ measureError }}
      </div>
    </div>

    <!-- REVERTIDO: Se quitó el Input de Tiendas -->

    <!-- Botón de Búsqueda (Sin cambios) -->
    <button class="search-button" (click)="onSearch()">
      <span *ngIf="!hasSearched">Buscar</span>
      <img *ngIf="hasSearched" src="assets/images/logopequ.png" alt="Buscar" class="search-button-icon">
    </button>

  </div>

  <footer class="footer" *ngIf="!hasSearched">
    <p>Syntara • Los precios hablan, Syntara escucha. ©</p>
  </footer>
</main>
